# Client Setup

This guide explains how to configure Lynis clients to send audit reports to your TrikuSec server.

!!! info "Security Note"
    TrikuSec uses a **read-only model** - it only receives audit data from your servers. The only requirement is [Lynis](https://cisofy.com/lynis/), a well-established open-source tool that can be installed via standard package managers. No proprietary agents or additional services are required.

## Prerequisites

- A running TrikuSec server
- A license key (generated by the server)
- Lynis installed on the client server (available in standard Linux repositories)

## Installation Steps

### 1. Install Lynis

On Debian/Ubuntu:

```bash
sudo apt install lynis
```

On other distributions, use your package manager or install from source.

### 2. Generate License Key

First, you need to obtain a license key from your TrikuSec server. This can be done through:

- The web interface (after logging in)
- The admin API endpoint
- The management command

### 3. Create Custom Profile

Create a custom Lynis profile at `/etc/lynis/custom.prf`:

```ini
# Custom profile for TrikuSec
upload=yes
# License key from TrikuSec server
license-key=YOUR_LICENSE_KEY
# Point to the TrikuSec server
upload-server=yourserver:3000/api/lynis
# Required for self-signed certificates
upload-options=--insecure

# Custom settings
# Too slow. Old systems do not support ignoring some directories
test_skip_always=CRYP-7902
```

Replace:
- `YOUR_LICENSE_KEY` with your actual license key
- `yourserver:3000` with your TrikuSec server address

### 4. Run Audit

Run Lynis with the custom profile:

```bash
lynis audit system --upload --quick
```

This will:
1. Perform a system audit
2. Upload the results to your TrikuSec server

!!! note "Upload Only"
    You can use `lynis only-upload` to upload the last audit results without running a new audit.

### 5. Schedule Regular Audits

For automated monitoring, schedule regular audits with cron.

On recent Debian/Ubuntu versions, you can use the systemd timer:

```bash
systemctl start lynis.timer
systemctl enable lynis.timer
```

Or create a cron job:

```bash
# Edit crontab
crontab -e

# Add line to run audit daily at 2 AM
0 2 * * * /usr/sbin/lynis audit system --upload --quick
```

## Recommended Packages

For the most comprehensive audit results, install these packages:

```bash
sudo apt install rkhunter auditd aide
```

These packages enable additional security checks:
- **rkhunter**: Rootkit detection
- **auditd**: Linux audit daemon
- **aide**: File integrity monitoring

## Troubleshooting

### Connection Issues

If you're having trouble connecting to the server:

1. **Check server URL**: Ensure `upload-server` points to the correct address
2. **Check firewall**: Ensure port 3000 (or your configured port) is open
3. **Check SSL**: If using HTTPS, ensure certificates are valid or use `--insecure` flag

### License Key Issues

If you get license key errors:

1. Verify the license key is correct in `/etc/lynis/custom.prf`
2. Check that the license key exists in TrikuSec server
3. Ensure the license key hasn't been revoked

### Upload Failures

If uploads fail:

1. Check network connectivity: `curl -k https://yourserver:3000/api/lynis/license`
2. Check server logs: `docker compose logs trikusec`
3. Verify the API endpoint is accessible

## Next Steps

- [Using TrikuSec](../usage/getting-started.md) - Learn how to view and manage reports
- [API Reference](../api/index.md) - For programmatic client setup

