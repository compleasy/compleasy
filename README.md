# Compleasy

> [!WARNING]
> This project is still in development and should NOT be used in production.

**Compleasy** is a Linux server auditing solution based on [Lynis](https://cisofy.com/lynis/). It is designed to simplify and automate the process of ensuring your servers adhere to security and operational policies.

## Features

- **Easy implementation:** Compleasy server is a Docker-based solution that can be deployed in minutes.
- **Easy configuration:** Compleasy client is based on Lynis, which can be installed on any Linux server in seconds.
- **Centralized management:** All audit results are sent to the Compleasy server, where they can be viewed and managed.
- **Customizable policies:** Compleasy allows you to define custom policies that can be applied to all servers.

## Installation vÃ­a Docker

### Prerequisites

Before starting, you need to set up the required environment variables:

1. Copy the example environment file:

```bash
cp .env.example .env
```

2. Generate a secure SECRET_KEY:

```bash
python3 -c "import secrets; print(secrets.token_urlsafe(50))"
```

3. Edit the `.env` file and replace `your-secret-key-here` with the generated key, or set it directly in `docker-compose.yml`.

### Setup

1. Clone the repository:

```bash
git clone https://github.com/compleasy/compleasy.git
```

2. Change to the project directory:

```bash
cd compleasy
```

> [!IMPORTANT]
> **Security Note:** The `SECRET_KEY` is a critical security setting for Django. Never commit your actual secret key to version control. The key in `docker-compose.yml` is provided as an example and should be changed for any deployment.

3. Run docker-compose:

```bash
docker-compose up
```

## Client configuration

1. Install Lynis:

```bash
sudo apt install lynis
```

2. Generate a Lynis custom profile `/etc/lynis/custom.prf`:

```ini
# Custom profile for Compleasy
upload=yes
# License key will be generated by the server on the first run
license-key=YOUR_LICENSE_KEY
# Point to the Compleasy server
upload-server=yourserver:3000/api/lynis
# Required for self-signed certificates
upload-options=--insecure

# Custom settings
# Too slow. Old systems do not support ignoring some directories
test_skip_always=CRYP-7902
```

3. Run Lynis with the custom profile and upload the results to the Compleasy server:

```bash
lynis audit system --upload --quick
```

> [!NOTE]
> You can use `lynis only-upload` to upload the last audit results.

4. Schedule the audit with a cron job (available in recent Debian/Ubuntu versions):

```bash
systemctl start lynis.timer
```

5. (Recommended) Install the following packages to get the most out of Lynis:

```bash
sudo apt install rkhunter auditd aide
```


## Using Compleasy

1. Access the Compleasy server at `http://yourserver:3000`.


### Advanced configuration

- **Add a license key**: `curl -k https://yourserver:3000/admin/license -X POST -d "licensekey=YOUR_LICENSE`
- **Empty the database**: `curl https://yourserver:3000/admin/db/init?delete=true -k`